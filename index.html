<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VPLY Telephone Diary</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      background: url('https://www.transparenttextures.com/patterns/wood-pattern.png');
      background-color: #e0c097;
    }
    .container {
      max-width: 900px;
      margin: auto;
      padding: 20px;
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
    }
    .login-screen, .main-app {
      display: none;
    }
    h1, h2 {
      text-align: center;
      color: #4b2e12;
    }
    input, button, select, textarea {
      padding: 8px;
      margin: 5px;
      width: 100%;
      box-sizing: border-box;
      border-radius: 5px;
    }
    .product-list input {
      width: 85%;
    }
    .delete-btn {
      color: red;
      cursor: pointer;
    }
    .copy-btn {
      color: green;
      font-size: 14px;
      cursor: pointer;
      margin-left: 5px;
    }
    a.tel-link {
      text-decoration: none;
      color: blue;
    }
  </style>
</head>
<body onload="showLoginScreen()">

<div class="container login-screen" id="login-screen">
  <h2>Enter Password to Access</h2>
  <input type="password" id="passwordInput" placeholder="Enter Password"/>
  <button onclick="checkPassword()">Enter</button>
</div>

<div class="container main-app" id="main-app">
  <img src="https://raw.githubusercontent.com/dhruvparmar17/vply-centre/main/assets/vplylogo.jpg" alt="Logo" style="max-width: 150px; display: block; margin: auto;">
  <h1>VPLY TELEPHONE DIARY</h1>

  <input type="text" id="search" placeholder="Search by any field..."/>
  <button onclick="searchEntries()">ğŸ” Search</button>

  <h2>Enter Company Details</h2>
  <input id="company" placeholder="Company Name" />
  <input id="category" placeholder="Category" />
  <input id="brand" placeholder="Brand" />

  <div id="product-fields">
    <h3>Brand Products (Max 10)</h3>
  </div>
  <button onclick="addProductField()">Add Product</button>

  <input id="address" placeholder="Company Address" />
  <input id="owner" placeholder="Owner Name" />
  <input id="ownerPhone" placeholder="Owner Phone" />
  <input id="salesman" placeholder="Salesman Name" />
  <input id="salesmanPhone" placeholder="Salesman Phone" />
  <input id="godown" placeholder="Godown No." />
  <input id="gst" placeholder="GST No." />
  <input type="file" accept="image/*" id="cardImage" capture="environment"/>

  <button onclick="saveData()">Save Entry</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDJXU1dwGZ7x11EC8-lI3u468NpuaZQfT8",
    authDomain: "vply-centre.firebaseapp.com",
    databaseURL: "https://vply-centre-default-rtdb.firebaseio.com",
    projectId: "vply-centre",
    storageBucket: "vply-centre.appspot.com",
    messagingSenderId: "180899405669",
    appId: "1:180899405669:web:571820a646057e91accb8c"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  let productCount = 0;

  function showLoginScreen() {
    document.getElementById("login-screen").style.display = "block";
  }

  function checkPassword() {
    const pass = document.getElementById('passwordInput').value;
    if (pass === "Vply@1") {
      document.getElementById('login-screen').style.display = "none";
      document.getElementById('main-app').style.display = "block";
    } else {
      alert("Wrong password!");
    }
  }

  function addProductField() {
    if (productCount >= 10) return alert("Max 10 products!");
    const id = `product${productCount}`;
    const div = document.createElement("div");
    div.className = "product-list";
    div.innerHTML = `<input id="${id}" placeholder="Product ${productCount + 1}" />
                     <span class="delete-btn" onclick="this.parentNode.remove();">âŒ</span>`;
    document.getElementById("product-fields").appendChild(div);
    productCount++;
  }

  function saveData() {
    const products = [];
    for (let i = 0; i < 10; i++) {
      const input = document.getElementById(`product${i}`);
      if (input) products.push(input.value);
    }

    const data = {
      company: document.getElementById("company").value,
      category: document.getElementById("category").value,
      brand: document.getElementById("brand").value,
      products: products,
      address: document.getElementById("address").value,
      owner: document.getElementById("owner").value,
      ownerPhone: document.getElementById("ownerPhone").value,
      salesman: document.getElementById("salesman").value,
      salesmanPhone: document.getElementById("salesmanPhone").value,
      godown: document.getElementById("godown").value,
      gst: document.getElementById("gst").value
    };

    db.ref("entries").push(data, () => {
      alert("âœ… Saved to Firebase!");
      sendToSheet(data);
      clearForm();
    });
  }

  function sendToSheet(data) {
    fetch("https://script.google.com/macros/s/AKfycbxDuvf5L628eJj_HVssfCmGi_qZi-OjKBy769G0CGIiGvC2or5AbxewkcWptTsILN5b1w/exec", {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
  }

  function clearForm() {
    ['company','category','brand','address','owner','ownerPhone','salesman','salesmanPhone','godown','gst'].forEach(id => document.getElementById(id).value = '');
    document.getElementById("product-fields").innerHTML = "";
    productCount = 0;
    document.getElementById("cardImage").value = "";
  }

  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
      alert("Copied: " + text);
    });
  }

  function deleteEntry(key, btnElement) {
    if (confirm("Are you sure you want to delete this entry?")) {
      db.ref("entries/" + key).remove(() => {
        alert("ğŸ—‘ï¸ Entry deleted.");
        btnElement.parentNode.remove();
      });
    }
  }

  function searchEntries() {
    const query = document.getElementById("search").value.toLowerCase().trim();
    if (!query) return alert("Please type something to search.");

    db.ref("entries").once("value", (snapshot) => {
      const data = snapshot.val();
      let found = [];

      if (data) {
        Object.entries(data).forEach(([key, entry]) => {
          const matchContent = Object.values(entry).join(" ").toLowerCase();
          if (matchContent.includes(query)) {
            found.push(`
<b>ğŸ“Œ Company:</b> ${entry.company}<br>
<b>ğŸ“ Category:</b> ${entry.category}<br>
<b>ğŸ·ï¸ Brand:</b> ${entry.brand}<br>
<b>ğŸ›’ Products:</b> ${(entry.products || []).join(", ")}<br>
<b>ğŸ“ Address:</b> ${entry.address}<br>
<b>ğŸ‘¤ Owner:</b> ${entry.owner} - 
<a href="tel:${entry.ownerPhone}" class="tel-link">${entry.ownerPhone}</a>
<span class="copy-btn" onclick="copyToClipboard('${entry.ownerPhone}')">ğŸ“‹</span><br>
<b>ğŸ§‘â€ğŸ’¼ Salesman:</b> ${entry.salesman} - 
<a href="tel:${entry.salesmanPhone}" class="tel-link">${entry.salesmanPhone}</a>
<span class="copy-btn" onclick="copyToClipboard('${entry.salesmanPhone}')">ğŸ“‹</span><br>
<b>ğŸ¢ Godown:</b> ${entry.godown}<br>
<b>ğŸ§¾ GST:</b> ${entry.gst}<br>
<button onclick="deleteEntry('${key}', this)">ğŸ—‘ï¸ Delete</button><hr>`);
          }
        });
      }

      const existingPopup = document.getElementById("popupResult");
      if (existingPopup) existingPopup.remove();

      if (found.length > 0) {
        const popup = document.createElement("div");
        popup.id = "popupResult";
        popup.style.cssText = "position:fixed; top:10%; left:5%; right:5%; max-height:80%; overflow:auto; background:white; border:2px solid black; padding:20px; z-index:9999;";
        popup.innerHTML = found.join("") + `<button onclick="this.parentNode.remove()">âŒ Close</button>`;
        document.body.appendChild(popup);
      } else {
        alert("âŒ No matching entry found.");
      }
    });
  }
</script>
</body>
</html>
