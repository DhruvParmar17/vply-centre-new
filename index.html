<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPLY Telephone Diary - Enhanced</title>
    <meta name="description" content="Enhanced VPLY Telephone Diary with advanced features for managing company contacts, locations, and business information." />
    <meta name="keywords" content="VPLY, telephone diary, business contacts, company management, plywood, laminates" />
    <meta name="author" content="VPLY Centre" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        /* Wood Theme Variables */
        :root {
            --wood-dark: #654321;
            --wood-medium: #8B5A2B;
            --wood-light: #A0744A;
            --wood-tan: #CDA474;
            --wood-natural: #DEB887;
            --wood-pale: #D2B48C;
            --wood-cream: #F5E6D3;
            
            --bg-primary: linear-gradient(135deg, var(--wood-cream) 0%, var(--wood-pale) 50%, var(--wood-natural) 100%);
            --bg-secondary: linear-gradient(135deg, var(--wood-pale) 0%, var(--wood-natural) 100%);
            --bg-card: linear-gradient(135deg, var(--wood-cream) 0%, var(--wood-pale) 100%);
            --text-primary: var(--wood-dark);
            --text-secondary: var(--wood-medium);
            --border-color: var(--wood-light);
            --shadow-color: rgba(101, 67, 33, 0.3);
            --accent-gradient: linear-gradient(135deg, var(--wood-light) 0%, var(--wood-medium) 100%);
        }

        [data-theme="dark"] {
            --bg-primary: linear-gradient(135deg, #2D1810 0%, #3D2318 50%, #4D2E20 100%);
            --bg-secondary: linear-gradient(135deg, #3D2318 0%, #4D2E20 100%);
            --bg-card: linear-gradient(135deg, #4D2E20 0%, #5D3928 100%);
            --text-primary: var(--wood-cream);
            --text-secondary: var(--wood-pale);
            --border-color: var(--wood-light);
            --shadow-color: rgba(0, 0, 0, 0.5);
            --accent-gradient: linear-gradient(135deg, var(--wood-light) 0%, var(--wood-medium) 100%);
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        /* Wood grain texture overlays */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' stroke='%23A0744A' stroke-width='0.5' opacity='0.3'%3E%3Cpath d='M0 20c20 0 20 20 40 20s20-20 40-20 20 20 40 20v20c-20 0-20 20-40 20s-20-20-40-20-20 20-40 20z'/%3E%3Cpath d='M0 60c20 0 20 20 40 20s20-20 40-20 20 20 40 20v20c-20 0-20 20-40 20s-20-20-40-20-20 20-40 20z'/%3E%3C/g%3E%3C/svg%3E"),
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23CDA474' fill-opacity='0.1'%3E%3Cpath d='M30 0c16.569 0 30 13.431 30 30s-13.431 30-30 30S0 46.569 0 30 13.431 0 30 0zm0 6c13.255 0 24 10.745 24 24s-10.745 24-24 24S6 43.255 6 30 16.745 6 30 6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.2;
            pointer-events: none;
            z-index: -1;
        }

        /* Container styles */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
            position: relative;
            z-index: 1;
        }

        /* Login screen styles */
        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .login-card {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 
                0 25px 50px -12px var(--shadow-color),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 3px solid var(--border-color);
            max-width: 28rem;
            width: 100%;
            position: relative;
            backdrop-filter: blur(10px);
            transform: scale(1);
            transition: all 0.3s ease;
        }

        .login-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23A0744A' fill-opacity='0.1'%3E%3Cpath d='M0 10c5 0 10 5 10 10s-5 10-10 10v10c5 0 10-5 10-10s5-10 10-10 10 5 10 10-5 10-10 10v10c5 0 10-5 10-10s5-10 10-10v-40z'/%3E%3C/g%3E%3C/svg%3E");
            border-radius: 1.5rem;
            pointer-events: none;
        }

        .login-card:hover {
            transform: scale(1.02);
            box-shadow: 
                0 35px 70px -12px var(--shadow-color),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .login-content {
            position: relative;
            z-index: 10;
            text-align: center;
        }

        .logo {
            max-width: 8rem;
            margin: 0 auto 1rem;
            border-radius: 1rem;
            box-shadow: 
                0 10px 25px -5px var(--shadow-color),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 3px solid var(--border-color);
        }

        .login-title {
            font-size: 1.75rem;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            text-shadow: 0 1px 2px var(--shadow-color);
        }

        .login-subtitle {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        /* Header styles */
        .header-card {
            background: var(--bg-card);
            border-radius: 1.5rem;
            box-shadow: 
                0 25px 50px -12px var(--shadow-color),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 3px solid var(--border-color);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .header-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' stroke='%23CDA474' stroke-width='1' opacity='0.2'%3E%3Cpath d='M0 20c20 0 20 20 40 20s20-20 40-20 20 20 40 20v20c-20 0-20 20-40 20s-20-20-40-20-20 20-40 20z'/%3E%3C/g%3E%3C/svg%3E");
            border-radius: 1.5rem;
            pointer-events: none;
        }

        .header-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.75rem;
            z-index: 10;
        }

        .control-btn {
            padding: 0.75rem;
            border-radius: 0.75rem;
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 4px 15px -3px var(--shadow-color),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
        }

        .control-btn:hover {
            transform: scale(1.1);
            box-shadow: 
                0 8px 25px -5px var(--shadow-color),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .main-title {
            font-size: 2rem;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            letter-spacing: 0.05em;
            text-shadow: 0 2px 4px var(--shadow-color);
        }

        .title-underline {
            height: 0.25rem;
            width: 6rem;
            background: var(--accent-gradient);
            margin: 0 auto;
            border-radius: 9999px;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        /* Section card styles */
        .section-card {
            background: var(--bg-card);
            border-radius: 1.5rem;
            box-shadow: 
                0 10px 25px -5px var(--shadow-color),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 2px solid var(--border-color);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .section-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23DEB887' fill-opacity='0.05'%3E%3Cpath d='M0 15c7.5 0 15 7.5 15 15s-7.5 15-15 15v15c7.5 0 15-7.5 15-15s7.5-15 15-15 15 7.5 15 15-7.5 15-15 15v15c7.5 0 15-7.5 15-15s7.5-15 15-15v-60z'/%3E%3C/g%3E%3C/svg%3E");
            border-radius: 1.5rem;
            pointer-events: none;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 1rem;
            text-align: center;
            text-shadow: 0 1px 2px var(--shadow-color);
        }

        /* Input styles */
        .input-group {
            position: relative;
            margin-bottom: 1rem;
        }

        input, textarea, select {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 0.75rem;
            outline: none;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        input::placeholder, textarea::placeholder {
            color: var(--text-secondary);
        }

        input:focus, textarea:focus, select:focus {
            border-color: var(--wood-light);
            box-shadow: 
                0 0 0 4px rgba(160, 116, 74, 0.2),
                inset 0 2px 4px rgba(0, 0, 0, 0.1);
            transform: scale(1.02);
        }

        /* Button styles */
        .btn {
            padding: 0.75rem 1.5rem;
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 10px 25px -5px rgba(160, 116, 74, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 2px solid var(--border-color);
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 
                0 20px 40px -10px rgba(160, 116, 74, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn:active {
            transform: translateY(0) scale(0.95);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #5B7C99 0%, #4A6B88 100%);
            box-shadow: 
                0 10px 25px -5px rgba(91, 124, 153, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            box-shadow: 
                0 20px 40px -10px rgba(91, 124, 153, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-green {
            background: linear-gradient(135deg, #6B8E5A 0%, #5A7D49 100%);
            box-shadow: 
                0 10px 25px -5px rgba(107, 142, 90, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-green:hover {
            box-shadow: 
                0 20px 40px -10px rgba(107, 142, 90, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-red {
            background: linear-gradient(135deg, #B85450 0%, #A74440 100%);
            box-shadow: 
                0 10px 25px -5px rgba(184, 84, 80, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-red:hover {
            box-shadow: 
                0 20px 40px -10px rgba(184, 84, 80, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        /* Grid layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        /* Search and filter styles */
        .search-container {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            overflow-x: auto;
        }

        .tab {
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 0.875rem;
            box-shadow: 
                0 4px 15px -3px var(--shadow-color),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .tab.active {
            background: var(--accent-gradient);
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .tab:hover {
            transform: scale(1.05);
        }

        /* Category filters */
        .category-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .category-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 
                0 4px 15px -3px var(--shadow-color),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .category-btn.active {
            background: var(--accent-gradient);
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .category-btn:hover {
            transform: scale(1.05);
        }

        /* Company card styles */
        .company-card {
            background: var(--bg-card);
            border-radius: 1rem;
            border: 2px solid var(--border-color);
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 
                0 4px 15px -3px var(--shadow-color),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            backdrop-filter: blur(5px);
        }

        .company-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23D2B48C' fill-opacity='0.05'%3E%3Cpath d='M0 10c5 0 10 5 10 10s-5 10-10 10v10c5 0 10-5 10-10s5-10 10-10 10 5 10 10-5 10-10 10v10c5 0 10-5 10-10s5-10 10-10v-40z'/%3E%3C/g%3E%3C/svg%3E");
            border-radius: 1rem;
            pointer-events: none;
        }

        .company-card:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 
                0 8px 25px -5px var(--shadow-color),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .company-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .company-info h3 {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            text-shadow: 0 1px 2px var(--shadow-color);
        }

        .company-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .tag {
            padding: 0.25rem 0.75rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 9999px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .favorite-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0.5rem;
            border-radius: 0.5rem;
            color: var(--text-secondary);
        }

        .favorite-btn:hover {
            transform: scale(1.2);
            background: var(--bg-secondary);
        }

        .favorite-btn.active {
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        /* Contact section */
        .contact-section {
            background: var(--bg-secondary);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }

        .contact-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .contact-info {
            flex: 1;
        }

        .contact-name {
            font-weight: bold;
            color: var(--text-primary);
        }

        .contact-phone {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .contact-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .call-btn { background: linear-gradient(135deg, #6B8E5A 0%, #5A7D49 100%); }
        .email-btn { background: linear-gradient(135deg, #5B7C99 0%, #4A6B88 100%); }
        .whatsapp-btn { background: linear-gradient(135deg, #25D366 0%, #20B954 100%); }
        .map-btn { background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%); }

        /* Product section */
        .products-section {
            margin-bottom: 1rem;
        }

        .products-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .product-tag {
            padding: 0.25rem 0.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* Image gallery */
        .image-gallery {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        .gallery-image {
            width: 4rem;
            height: 4rem;
            object-fit: cover;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid var(--border-color);
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        .gallery-image:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        /* File upload styles */
        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
            margin-bottom: 1rem;
        }

        .file-upload input[type=file] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-label {
            display: block;
            padding: 1rem;
            background: var(--bg-secondary);
            border: 2px dashed var(--border-color);
            border-radius: 0.75rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .file-upload:hover .file-upload-label {
            background: var(--bg-card);
            transform: scale(1.02);
            border-color: var(--wood-light);
        }

        /* Language selector */
        .language-selector {
            position: relative;
            display: inline-block;
        }

        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px -5px var(--shadow-color);
            z-index: 100;
            min-width: 150px;
            display: none;
            backdrop-filter: blur(10px);
        }

        .language-dropdown.show {
            display: block;
        }

        .language-option {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
        }

        .language-option:hover {
            background: var(--bg-secondary);
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            color: white;
            font-weight: bold;
            z-index: 9999;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 300px;
            word-wrap: break-word;
            backdrop-filter: blur(10px);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success { 
            background: linear-gradient(135deg, #6B8E5A 0%, #5A7D49 100%);
            border: 2px solid #7DA068;
        }
        .toast.error { 
            background: linear-gradient(135deg, #B85450 0%, #A74440 100%);
            border: 2px solid #C66258;
        }
        .toast.info { 
            background: linear-gradient(135deg, #5B7C99 0%, #4A6B88 100%);
            border: 2px solid #698AA7;
        }

        /* Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
            20%, 40%, 60%, 80% { transform: translateX(2px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .shake { animation: shake 0.5s ease-in-out; }
        .pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .fade-in { animation: fadeIn 0.3s ease-out; }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .container { padding: 0.5rem; }
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .search-container { flex-direction: column; }
            .main-title { font-size: 1.5rem; }
            .header-controls { position: static; margin-bottom: 1rem; justify-content: center; }
            .company-header { flex-direction: column; gap: 1rem; }
            .contact-item { flex-direction: column; gap: 0.5rem; align-items: flex-start; }
            .contact-actions { justify-content: flex-start; }
        }

        @media (max-width: 480px) {
            .login-card { margin: 0.5rem; padding: 1.5rem; }
            .section-card { padding: 1rem; }
            .main-title { font-size: 1.25rem; }
            .tabs { flex-direction: column; }
            .category-filters { flex-direction: column; }
        }

        /* Utility classes */
        .hidden { display: none !important; }
        .loading { opacity: 0.7; pointer-events: none; }
        .text-center { text-align: center; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .w-full { width: 100%; }
        .flex { display: flex; }
        .flex-wrap { flex-wrap: wrap; }
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }

        /* Empty state styling */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .empty-state-subtext {
            font-size: 0.9rem;
            opacity: 0.7;
        }
    </style>
</head>
<body onload="initializeApp()">
    <!-- Login Screen -->
    <div class="login-screen" id="login-screen">
        <div class="login-card">
            <div class="login-content">
                <img src="https://dhruvparmar17.github.io/vply-centre-new/vplylogo.jpg" alt="VPLY Logo" class="logo">
                <h2 class="login-title" id="login-title">VPLY Access</h2>
                <p class="login-subtitle" id="login-subtitle">Enter password to continue</p>
                
                <div class="input-group">
                    <input type="password" id="passwordInput" placeholder="Enter Password" />
                    <button type="button" class="control-btn" onclick="togglePassword()" style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); padding: 0.5rem;">
                        <span id="toggleIcon">üëÅÔ∏è</span>
                    </button>
                </div>
                
                <button class="btn w-full" onclick="checkPassword()">
                    <span id="login-btn-text">Enter Diary</span>
                    <div class="pulse" style="width: 8px; height: 8px; background: white; border-radius: 50%;"></div>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="main-app hidden" id="main-app">
        <div class="container">
            <!-- Header -->
            <div class="header-card">
                <div class="header-controls">
                    <!-- Theme Toggle -->
                    <button class="control-btn" onclick="toggleTheme()" id="theme-toggle" title="Toggle Theme">
                        <span id="theme-icon">üåô</span>
                    </button>
                    
                    <!-- Language Selector -->
                    <div class="language-selector">
                        <button class="control-btn" onclick="toggleLanguageDropdown()" id="language-btn">
                            <span id="current-flag">üá∫üá∏</span>
                            <span id="current-lang">EN</span>
                        </button>
                        <div class="language-dropdown" id="language-dropdown">
                            <div class="language-option" onclick="setLanguage('en')">
                                <span>üá∫üá∏</span>
                                <span>English</span>
                            </div>
                            <div class="language-option" onclick="setLanguage('hi')">
                                <span>üáÆüá≥</span>
                                <span>‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</span>
                            </div>
                            <div class="language-option" onclick="setLanguage('mr')">
                                <span>üáÆüá≥</span>
                                <span>‡§Æ‡§∞‡§æ‡§†‡•Ä</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Undo Button -->
                    <button class="control-btn hidden" onclick="undoLastAction()" id="undo-btn" title="Undo Last Action">
                        <span>‚Ü∂</span>
                    </button>
                </div>
                
                <img src="https://dhruvparmar17.github.io/vply-centre-new/vplylogo.jpg" alt="VPLY Logo" class="logo" style="max-width: 9rem;">
                <h1 class="main-title" id="main-title">VPLY TELEPHONE DIARY</h1>
                <div class="title-underline"></div>
            </div>

            <!-- Search Section -->
            <div class="section-card">
                <!-- Search Tabs -->
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('search')" id="tab-search">
                        üîç <span data-translate="search">Search</span>
                    </div>
                    <div class="tab" onclick="switchTab('recent')" id="tab-recent">
                        üïí <span data-translate="recent">Recent</span>
                    </div>
                    <div class="tab" onclick="switchTab('favorites')" id="tab-favorites">
                        ‚≠ê <span data-translate="favorites">Favorites</span>
                    </div>
                </div>

                <!-- Search Content -->
                <div id="search-content">
                    <div class="search-container">
                        <input type="text" id="search" placeholder="Search by company, category, brand, owner..." class="search-input" oninput="showSearchSuggestions()" />
                        <button class="btn btn-secondary" onclick="searchEntries()">
                            üîç <span data-translate="search">Search</span>
                        </button>
                    </div>
                    
                    <!-- Search Suggestions -->
                    <div id="search-suggestions" class="hidden" style="background: var(--bg-card); border: 2px solid var(--border-color); border-radius: 0.75rem; margin-top: 0.5rem; max-height: 200px; overflow-y: auto;"></div>
                    
                    <!-- Category Filters -->
                    <div class="category-filters">
                        <div class="category-btn active" onclick="filterByCategory('all')" data-category="all">
                            üè¢ <span data-translate="all">All</span>
                        </div>
                        <div class="category-btn" onclick="filterByCategory('plywood')" data-category="plywood">
                            ü™µ <span data-translate="plywood">Plywood</span>
                        </div>
                        <div class="category-btn" onclick="filterByCategory('laminates')" data-category="laminates">
                            ‚ú® <span data-translate="laminates">Laminates</span>
                        </div>
                        <div class="category-btn" onclick="filterByCategory('hardware')" data-category="hardware">
                            üîß <span data-translate="hardware">Hardware</span>
                        </div>
                    </div>
                    
                    <!-- Empty state for search -->
                    <div id="search-empty-state" class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <div class="empty-state-text">Search for companies</div>
                        <div class="empty-state-subtext">Use the search bar above to find companies by name, category, brand, or owner</div>
                    </div>
                </div>

                <!-- Recent Content -->
                <div id="recent-content" class="hidden">
                    <div id="recent-entries"></div>
                </div>

                <!-- Favorites Content -->
                <div id="favorites-content" class="hidden">
                    <div id="favorite-entries"></div>
                </div>

                <!-- Search Results -->
                <div id="search-results"></div>
            </div>

            <!-- Entry Form -->
            <div class="section-card">
                <h2 class="section-title" data-translate="enter-details">Enter Company Details</h2>
                
                <!-- Basic Information -->
                <div class="grid-2">
                    <input id="company" placeholder="Company Name" data-translate-placeholder="company-name" />
                    <input id="category" placeholder="Category" data-translate-placeholder="category" />
                    <input id="brand" placeholder="Brand" data-translate-placeholder="brand" />
                    <div class="flex gap-1">
                        <input id="address" placeholder="Company Address" data-translate-placeholder="address" style="flex: 1;" />
                        <button class="btn btn-secondary" onclick="getCurrentLocation()" id="location-btn" title="Get Current Location">
                            üìç
                        </button>
                    </div>
                </div>

                <!-- Products Section -->
                <div style="margin: 1.5rem 0;">
                    <div class="flex justify-between items-center mb-2">
                        <h3 style="color: var(--text-primary); margin: 0;" data-translate="products">Brand Products (Max 10)</h3>
                        <button class="btn btn-green btn-small" onclick="addProductField()">
                            ‚ûï <span data-translate="add-product">Add Product</span>
                        </button>
                    </div>
                    <div id="product-fields"></div>
                </div>

                <!-- Contact Information -->
                <div class="grid-2">
                    <input id="owner" placeholder="Owner Name" data-translate-placeholder="owner-name" />
                    <input id="ownerPhone" placeholder="Owner Phone" data-translate-placeholder="owner-phone" />
                    <input id="ownerEmail" placeholder="Owner Email" data-translate-placeholder="owner-email" />
                    <input id="salesman" placeholder="Salesman Name" data-translate-placeholder="salesman-name" />
                    <input id="salesmanPhone" placeholder="Salesman Phone" data-translate-placeholder="salesman-phone" />
                    <input id="salesmanEmail" placeholder="Salesman Email" data-translate-placeholder="salesman-email" />
                    <input id="godown" placeholder="Godown No." data-translate-placeholder="godown" />
                    <input id="gst" placeholder="GST No." data-translate-placeholder="gst" />
                </div>

                <!-- Notes -->
                <textarea id="notes" placeholder="Additional Notes" data-translate-placeholder="notes" rows="3" style="resize: vertical;"></textarea>

                <!-- File Uploads -->
                <div class="grid-2">
                    <div class="file-upload">
                        <input type="file" accept="image/*" id="cardImage" multiple capture="environment" onchange="handleImageUpload(this, 'card')" />
                        <label for="cardImage" class="file-upload-label">
                            üì∑ <span data-translate="upload-card">Upload Business Card</span>
                        </label>
                    </div>
                    <div class="file-upload">
                        <input type="file" accept="image/*" id="productImages" multiple capture="environment" onchange="handleImageUpload(this, 'product')" />
                        <label for="productImages" class="file-upload-label">
                            üñºÔ∏è <span data-translate="upload-products">Upload Product Images</span>
                        </label>
                    </div>
                </div>

                <!-- Image Previews -->
                <div id="image-previews" class="image-gallery"></div>

                <!-- Save Button -->
                <button class="btn w-full" onclick="saveData()" style="margin-top: 1.5rem; font-size: 1.125rem; padding: 1rem;">
                    üíæ <span data-translate="save-entry">Save Entry</span>
                    <div class="pulse" style="width: 8px; height: 8px; background: white; border-radius: 50%;"></div>
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

    <script>
        // Global variables
        let currentLanguage = 'en';
        let currentTheme = 'light';
        let productCount = 0;
        let currentLocation = null;
        let favorites = new Set();
        let recentEntries = [];
        let undoStack = [];
        let currentFilter = 'all';
        let allEntries = {};
        let searchSuggestions = [];

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDJXU1dwGZ7x11EC8-lI3u468NpuaZQfT8",
            authDomain: "vply-centre.firebaseapp.com",
            databaseURL: "https://vply-centre-default-rtdb.firebaseio.com",
            projectId: "vply-centre",
            storageBucket: "vply-centre.appspot.com",
            messagingSenderId: "180899405669",
            appId: "1:180899405669:web:571820a646057e91accb8c"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const storage = firebase.storage();

        // Translations
        const translations = {
            en: {
                'login-title': 'VPLY Access',
                'login-subtitle': 'Enter password to continue',
                'login-btn': 'Enter Diary',
                'wrong-password': 'Wrong password!',
                'welcome': 'Welcome to VPLY Telephone Diary!',
                'search': 'Search',
                'recent': 'Recent',
                'favorites': 'Favorites',
                'all': 'All',
                'plywood': 'Plywood',
                'laminates': 'Laminates',
                'hardware': 'Hardware',
                'enter-details': 'Enter Company Details',
                'company-name': 'Company Name',
                'category': 'Category',
                'brand': 'Brand',
                'address': 'Company Address',
                'products': 'Brand Products (Max 10)',
                'add-product': 'Add Product',
                'owner-name': 'Owner Name',
                'owner-phone': 'Owner Phone',
                'owner-email': 'Owner Email',
                'salesman-name': 'Salesman Name',
                'salesman-phone': 'Salesman Phone',
                'salesman-email': 'Salesman Email',
                'godown': 'Godown No.',
                'gst': 'GST No.',
                'notes': 'Additional Notes',
                'upload-card': 'Upload Business Card',
                'upload-products': 'Upload Product Images',
                'save-entry': 'Save Entry',
                'saved': 'Entry saved successfully!',
                'updated': 'Entry updated successfully!',
                'deleted': 'Entry deleted successfully!',
                'location-obtained': 'Location obtained successfully!',
                'max-products': 'Maximum 10 products allowed!',
                'confirm-delete': 'Are you sure you want to delete this entry?',
                'no-results': 'No matching entries found.',
                'found-results': 'Found {count} matching entries!',
                'enter-search': 'Please enter a search term.',
                'favorite-added': 'Added to favorites!',
                'favorite-removed': 'Removed from favorites!',
                'undo-success': 'Action undone successfully!',
                'no-undo': 'Nothing to undo.',
                'call': 'Call',
                'email': 'Email',
                'whatsapp': 'WhatsApp',
                'maps': 'Maps',
                'directions': 'Directions'
            },
            hi: {
                'login-title': 'VPLY ‡§™‡§π‡•Å‡§Ç‡§ö',
                'login-subtitle': '‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                'login-btn': '‡§°‡§æ‡§Ø‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§ï‡§∞‡•á‡§Ç',
                'wrong-password': '‡§ó‡§≤‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°!',
                'welcome': 'VPLY ‡§ü‡•á‡§≤‡•Ä‡§´‡•ã‡§® ‡§°‡§æ‡§Ø‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à!',
                'search': '‡§ñ‡•ã‡§ú‡•á‡§Ç',
                'recent': '‡§π‡§æ‡§≤ ‡§ï‡•Ä',
                'favorites': '‡§™‡§∏‡§Ç‡§¶‡•Ä‡§¶‡§æ',
                'all': '‡§∏‡§≠‡•Ä',
                'plywood': '‡§™‡•ç‡§≤‡§æ‡§á‡§µ‡•Å‡§°',
                'laminates': '‡§≤‡•à‡§Æ‡§ø‡§®‡•á‡§ü‡•ç‡§∏',
                'hardware': '‡§π‡§æ‡§∞‡•ç‡§°‡§µ‡•á‡§Ø‡§∞',
                'enter-details': '‡§ï‡§Ç‡§™‡§®‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                'company-name': '‡§ï‡§Ç‡§™‡§®‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ',
                'category': '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä',
                'brand': '‡§¨‡•ç‡§∞‡§æ‡§Ç‡§°',
                'address': '‡§ï‡§Ç‡§™‡§®‡•Ä ‡§ï‡§æ ‡§™‡§§‡§æ',
                'products': '‡§¨‡•ç‡§∞‡§æ‡§Ç‡§° ‡§â‡§§‡•ç‡§™‡§æ‡§¶ (‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ 10)',
                'add-product': '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
                'owner-name': '‡§Æ‡§æ‡§≤‡§ø‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ',
                'owner-phone': '‡§Æ‡§æ‡§≤‡§ø‡§ï ‡§ï‡§æ ‡§´‡•ã‡§®',
                'owner-email': '‡§Æ‡§æ‡§≤‡§ø‡§ï ‡§ï‡§æ ‡§à‡§Æ‡•á‡§≤',
                'salesman-name': '‡§∏‡•á‡§≤‡•ç‡§∏‡§Æ‡•à‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ',
                'salesman-phone': '‡§∏‡•á‡§≤‡•ç‡§∏‡§Æ‡•à‡§® ‡§ï‡§æ ‡§´‡•ã‡§®',
                'salesman-email': '‡§∏‡•á‡§≤‡•ç‡§∏‡§Æ‡•à‡§® ‡§ï‡§æ ‡§à‡§Æ‡•á‡§≤',
                'godown': '‡§ó‡•ã‡§¶‡§æ‡§Æ ‡§®‡§Ç‡§¨‡§∞',
                'gst': 'GST ‡§®‡§Ç‡§¨‡§∞',
                'notes': '‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§®‡•ã‡§ü‡•ç‡§∏',
                'upload-card': '‡§¨‡§ø‡§ú‡§®‡•á‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç',
                'upload-products': '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§õ‡§µ‡§ø‡§Ø‡§æ‡§Ç ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç',
                'save-entry': '‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø ‡§∏‡§π‡•á‡§ú‡•á‡§Ç',
                'saved': '‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡§π‡•á‡§ú‡•Ä ‡§ó‡§à!',
                'updated': '‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡•Ä ‡§ó‡§à!',
                'deleted': '‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§π‡§ü‡§æ‡§à ‡§ó‡§à!',
                'location-obtained': '‡§∏‡•ç‡§•‡§æ‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!',
                'max-products': '‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ 10 ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡•ã‡§Ç ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§π‡•à!',
                'confirm-delete': '‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§á‡§∏ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?',
                'no-results': '‡§ï‡•ã‡§à ‡§Æ‡§ø‡§≤‡§æ‡§® ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä‡•§',
                'found-results': '{count} ‡§Æ‡§ø‡§≤‡§æ‡§® ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Ç ‡§Æ‡§ø‡§≤‡•Ä‡§Ç!',
                'enter-search': '‡§ï‡•É‡§™‡§Ø‡§æ ‡§ñ‡•ã‡§ú ‡§∂‡§¨‡•ç‡§¶ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§',
                'favorite-added': '‡§™‡§∏‡§Ç‡§¶‡•Ä‡§¶‡§æ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ!',
                'favorite-removed': '‡§™‡§∏‡§Ç‡§¶‡•Ä‡§¶‡§æ ‡§∏‡•á ‡§π‡§ü‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ!',
                'undo-success': '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!',
                'no-undo': '‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•Å‡§õ ‡§®‡§π‡•Ä‡§Ç‡•§',
                'call': '‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç',
                'email': '‡§à‡§Æ‡•á‡§≤',
                'whatsapp': '‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§ê‡§™',
                'maps': '‡§Æ‡•à‡§™‡•ç‡§∏',
                'directions': '‡§¶‡§ø‡§∂‡§æ-‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂'
            },
            mr: {
                'login-title': 'VPLY ‡§™‡•ç‡§∞‡§µ‡•á‡§∂',
                'login-subtitle': '‡§∏‡•Å‡§∞‡•Ç ‡§†‡•á‡§µ‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ü‡§æ‡§ï‡§æ',
                'login-btn': '‡§°‡§æ‡§Ø‡§∞‡•Ä‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§ï‡§∞‡§æ',
                'wrong-password': '‡§ö‡•Å‡§ï‡•Ä‡§ö‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°!',
                'welcome': 'VPLY ‡§ü‡•á‡§≤‡§ø‡§´‡•ã‡§® ‡§°‡§æ‡§Ø‡§∞‡•Ä‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§Ü‡§™‡§≤‡•á ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§Ü‡§π‡•á!',
                'search': '‡§∂‡•ã‡§ß‡§æ',
                'recent': '‡§Ö‡§≤‡•Ä‡§ï‡§°‡•Ä‡§≤',
                'favorites': '‡§Ü‡§µ‡§°‡•Ä‡§ö‡•ç‡§Ø‡§æ',
                'all': '‡§∏‡§∞‡•ç‡§µ',
                'plywood': '‡§™‡•ç‡§≤‡§æ‡§Ø‡§µ‡•Å‡§°',
                'laminates': '‡§≤‡•Ö‡§Æ‡§ø‡§®‡•á‡§ü‡•ç‡§∏',
                'hardware': '‡§π‡§æ‡§∞‡•ç‡§°‡§µ‡•á‡§Ö‡§∞',
                'enter-details': '‡§ï‡§Ç‡§™‡§®‡•Ä‡§ö‡•á ‡§§‡§™‡§∂‡•Ä‡§≤ ‡§≠‡§∞‡§æ',
                'company-name': '‡§ï‡§Ç‡§™‡§®‡•Ä‡§ö‡•á ‡§®‡§æ‡§µ',
                'category': '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä',
                'brand': '‡§¨‡•ç‡§∞‡§Å‡§°',
                'address': '‡§ï‡§Ç‡§™‡§®‡•Ä‡§ö‡§æ ‡§™‡§§‡•ç‡§§‡§æ',
                'products': '‡§¨‡•ç‡§∞‡§Å‡§° ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®‡•á (‡§ï‡§Æ‡§æ‡§≤ 10)',
                'add-product': '‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§ú‡•ã‡§°‡§æ',
                'owner-name': '‡§Æ‡§æ‡§≤‡§ï‡§æ‡§ö‡•á ‡§®‡§æ‡§µ',
                'owner-phone': '‡§Æ‡§æ‡§≤‡§ï‡§æ‡§ö‡§æ ‡§´‡•ã‡§®',
                'owner-email': '‡§Æ‡§æ‡§≤‡§ï‡§æ‡§ö‡§æ ‡§à‡§Æ‡•á‡§≤',
                'salesman-name': '‡§∏‡•á‡§≤‡•ç‡§∏‡§Æ‡§®‡§ö‡•á ‡§®‡§æ‡§µ',
                'salesman-phone': '‡§∏‡•á‡§≤‡•ç‡§∏‡§Æ‡§®‡§ö‡§æ ‡§´‡•ã‡§®',
                'salesman-email': '‡§∏‡•á‡§≤‡•ç‡§∏‡§Æ‡§®‡§ö‡§æ ‡§à‡§Æ‡•á‡§≤',
                'godown': '‡§ó‡•ã‡§¶‡§æ‡§Æ ‡§ï‡•ç‡§∞.',
                'gst': 'GST ‡§ï‡•ç‡§∞.',
                'notes': '‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ü‡§ø‡§™‡§æ',
                'upload-card': '‡§¨‡§ø‡§ù‡§®‡•á‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ',
                'upload-products': '‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ',
                'save-entry': '‡§®‡•ã‡§Ç‡§¶ ‡§ú‡§§‡§® ‡§ï‡§∞‡§æ',
                'saved': '‡§®‡•ã‡§Ç‡§¶ ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§∞‡§ø‡§§‡•ç‡§Ø‡§æ ‡§ú‡§§‡§® ‡§ï‡•á‡§≤‡•Ä!',
                'updated': '‡§®‡•ã‡§Ç‡§¶ ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§∞‡§ø‡§§‡•ç‡§Ø‡§æ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡•á‡§≤‡•Ä!',
                'deleted': '‡§®‡•ã‡§Ç‡§¶ ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§∞‡§ø‡§§‡•ç‡§Ø‡§æ ‡§π‡§ü‡§µ‡§≤‡•Ä!',
                'location-obtained': '‡§∏‡•ç‡§•‡§æ‡§® ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§∞‡§ø‡§§‡•ç‡§Ø‡§æ ‡§Æ‡§ø‡§≥‡§µ‡§≤‡•á!',
                'max-products': '‡§ï‡§Æ‡§æ‡§≤ 10 ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®‡§æ‡§Ç‡§®‡§æ ‡§™‡§∞‡§µ‡§æ‡§®‡§ó‡•Ä ‡§Ü‡§π‡•á!',
                'confirm-delete': '‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§ñ‡§∞‡§Ç‡§ö ‡§π‡•Ä ‡§®‡•ã‡§Ç‡§¶ ‡§π‡§ü‡§µ‡§æ‡§Ø‡§ö‡•Ä ‡§Ü‡§π‡•á ‡§ï‡§æ?',
                'no-results': '‡§ï‡•ã‡§£‡§§‡•Ä‡§π‡•Ä ‡§ú‡•Å‡§≥‡§£‡§æ‡§∞‡•Ä ‡§®‡•ã‡§Ç‡§¶ ‡§∏‡§æ‡§™‡§°‡§≤‡•Ä ‡§®‡§æ‡§π‡•Ä.',
                'found-results': '{count} ‡§ú‡•Å‡§≥‡§£‡§æ‡§±‡•ç‡§Ø‡§æ ‡§®‡•ã‡§Ç‡§¶‡•Ä ‡§∏‡§æ‡§™‡§°‡§≤‡•ç‡§Ø‡§æ!',
                'enter-search': '‡§ï‡•É‡§™‡§Ø‡§æ ‡§∂‡•ã‡§ß ‡§∂‡§¨‡•ç‡§¶ ‡§ü‡§æ‡§ï‡§æ.',
                'favorite-added': '‡§Ü‡§µ‡§°‡•Ä‡§ö‡•ç‡§Ø‡§æ ‡§Ø‡§æ‡§¶‡•Ä‡§§ ‡§ú‡•ã‡§°‡§≤‡•á!',
                'favorite-removed': '‡§Ü‡§µ‡§°‡•Ä‡§ö‡•ç‡§Ø‡§æ ‡§Ø‡§æ‡§¶‡•Ä‡§§‡•Ç‡§® ‡§ï‡§æ‡§¢‡§≤‡•á!',
                'undo-success': '‡§ï‡•É‡§§‡•Ä ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§∞‡§ø‡§§‡•ç‡§Ø‡§æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§§ ‡§ï‡•á‡§≤‡•Ä!',
                'no-undo': '‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§§ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§ï‡§æ‡§π‡•Ä‡§π‡•Ä ‡§®‡§æ‡§π‡•Ä.',
                'call': '‡§ï‡•â‡§≤ ‡§ï‡§∞‡§æ',
                'email': '‡§à‡§Æ‡•á‡§≤',
                'whatsapp': '‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§Ö‡§™',
                'maps': '‡§®‡§ï‡§æ‡§∂‡•á',
                'directions': '‡§¶‡§ø‡§∂‡§æ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂'
            }
        };

        // Initialize app
        function initializeApp() {
            loadSettings();
            updateLanguage();
            updateTheme();
            showLoginScreen();
            loadAllEntries();
        }

        // Load settings from localStorage
        function loadSettings() {
            currentLanguage = localStorage.getItem('vply-language') || 'en';
            currentTheme = localStorage.getItem('vply-theme') || 'light';
            favorites = new Set(JSON.parse(localStorage.getItem('vply-favorites') || '[]'));
            recentEntries = JSON.parse(localStorage.getItem('vply-recent') || '[]');
        }

        // Save settings to localStorage
        function saveSettings() {
            localStorage.setItem('vply-language', currentLanguage);
            localStorage.setItem('vply-theme', currentTheme);
            localStorage.setItem('vply-favorites', JSON.stringify([...favorites]));
            localStorage.setItem('vply-recent', JSON.stringify(recentEntries));
        }

        // Translation function
        function t(key, params = {}) {
            let text = translations[currentLanguage][key] || key;
            Object.keys(params).forEach(param => {
                text = text.replace(`{${param}}`, params[param]);
            });
            return text;
        }

        // Update language
        function updateLanguage() {
            const flags = { en: 'üá∫üá∏', hi: 'üáÆüá≥', mr: 'üáÆüá≥' };
            const names = { en: 'EN', hi: '‡§π‡§ø', mr: '‡§Æ‡§∞' };
            
            document.getElementById('current-flag').textContent = flags[currentLanguage];
            document.getElementById('current-lang').textContent = names[currentLanguage];
            
            // Update all translatable elements
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                el.textContent = t(key);
            });
            
            document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                const key = el.getAttribute('data-translate-placeholder');
                el.placeholder = t(key);
            });
            
            // Update specific elements
            document.getElementById('login-title').textContent = t('login-title');
            document.getElementById('login-subtitle').textContent = t('login-subtitle');
            document.getElementById('login-btn-text').textContent = t('login-btn');
            document.getElementById('main-title').textContent = 'VPLY ' + (currentLanguage === 'hi' ? '‡§ü‡•á‡§≤‡•Ä‡§´‡•ã‡§® ‡§°‡§æ‡§Ø‡§∞‡•Ä' : currentLanguage === 'mr' ? '‡§ü‡•á‡§≤‡§ø‡§´‡•ã‡§® ‡§°‡§æ‡§Ø‡§∞‡•Ä' : 'TELEPHONE DIARY');
        }

        // Set language
        function setLanguage(lang) {
            currentLanguage = lang;
            updateLanguage();
            saveSettings();
            toggleLanguageDropdown();
        }

        // Toggle language dropdown
        function toggleLanguageDropdown() {
            const dropdown = document.getElementById('language-dropdown');
            dropdown.classList.toggle('show');
        }

        // Update theme
        function updateTheme() {
            document.body.setAttribute('data-theme', currentTheme);
            document.getElementById('theme-icon').textContent = currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        }

        // Toggle theme
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            updateTheme();
            saveSettings();
        }

        // Show login screen
        function showLoginScreen() {
            document.getElementById("login-screen").classList.remove('hidden');
            document.getElementById("main-app").classList.add('hidden');
        }

        // Toggle password visibility
        function togglePassword() {
            const passwordInput = document.getElementById('passwordInput');
            const toggleIcon = document.getElementById('toggleIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                toggleIcon.textContent = 'üëÅÔ∏è';
            }
        }

        // Check password
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            const passwordInput = document.getElementById('passwordInput');
            
            if (password === "Vply@1") {
                document.getElementById("login-screen").classList.add('hidden');
                document.getElementById("main-app").classList.remove('hidden');
                showToast(t('welcome'), "success");
                addProductField(); // Add initial product field
                showEmptySearchState(); // Show empty state initially
            } else {
                passwordInput.classList.add('shake');
                showToast(t('wrong-password'), "error");
                setTimeout(() => {
                    passwordInput.classList.remove('shake');
                }, 500);
            }
        }

        // Load all entries from Firebase
        function loadAllEntries() {
            db.ref("entries").on("value", (snapshot) => {
                allEntries = snapshot.val() || {};
                updateSearchSuggestions();
                // Don't display entries automatically - only show when searched or in recent/favorites
            });
        }

        // Show empty search state
        function showEmptySearchState() {
            const searchResults = document.getElementById('search-results');
            const emptyState = document.getElementById('search-empty-state');
            
            searchResults.innerHTML = '';
            emptyState.classList.remove('hidden');
        }

        // Hide empty search state
        function hideEmptySearchState() {
            const emptyState = document.getElementById('search-empty-state');
            emptyState.classList.add('hidden');
        }

        // Update search suggestions
        function updateSearchSuggestions() {
            searchSuggestions = [];
            Object.values(allEntries).forEach(entry => {
                if (entry.company) searchSuggestions.push(entry.company);
                if (entry.category) searchSuggestions.push(entry.category);
                if (entry.brand) searchSuggestions.push(entry.brand);
                if (entry.owner) searchSuggestions.push(entry.owner);
                if (entry.salesman) searchSuggestions.push(entry.salesman);
            });
            searchSuggestions = [...new Set(searchSuggestions)]; // Remove duplicates
        }

        // Show search suggestions
        function showSearchSuggestions() {
            const query = document.getElementById('search').value.toLowerCase().trim();
            const suggestionsDiv = document.getElementById('search-suggestions');
            
            if (query.length < 2) {
                suggestionsDiv.classList.add('hidden');
                return;
            }
            
            const filtered = searchSuggestions.filter(suggestion => 
                suggestion.toLowerCase().includes(query)
            ).slice(0, 8);
            
            if (filtered.length > 0) {
                suggestionsDiv.innerHTML = filtered.map(suggestion => 
                    `<div style="padding: 0.75rem; cursor: pointer; border-bottom: 1px solid var(--border-color);" onclick="selectSuggestion('${suggestion}')">${suggestion}</div>`
                ).join('');
                suggestionsDiv.classList.remove('hidden');
            } else {
                suggestionsDiv.classList.add('hidden');
            }
        }

        // Select suggestion
        function selectSuggestion(suggestion) {
            document.getElementById('search').value = suggestion;
            document.getElementById('search-suggestions').classList.add('hidden');
            searchEntries();
        }

        // Switch tabs
        function switchTab(tab) {
            // Update tab appearance
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            // Show/hide content
            document.getElementById('search-content').classList.toggle('hidden', tab !== 'search');
            document.getElementById('recent-content').classList.toggle('hidden', tab !== 'recent');
            document.getElementById('favorites-content').classList.toggle('hidden', tab !== 'favorites');
            
            // Load content based on tab
            if (tab === 'recent') {
                displayRecentEntries();
            } else if (tab === 'favorites') {
                displayFavoriteEntries();
            } else if (tab === 'search') {
                showEmptySearchState();
            }
            
            // Clear search results when switching tabs
            if (tab !== 'search') {
                document.getElementById('search-results').innerHTML = '';
            }
        }

        // Filter by category
        function filterByCategory(category) {
            currentFilter = category;
            
            // Update button appearance
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-category="${category}"]`).classList.add('active');
            
            // Only filter if there's a search query
            const searchQuery = document.getElementById('search').value.trim();
            if (searchQuery) {
                searchEntries();
            }
        }

        // Display recent entries
        function displayRecentEntries() {
            const recentData = recentEntries.map(id => [id, allEntries[id]]).filter(([_, entry]) => entry);
            displayEntries(recentData, 'recent-entries');
        }

        // Display favorite entries
        function displayFavoriteEntries() {
            const favoriteData = [...favorites].map(id => [id, allEntries[id]]).filter(([_, entry]) => entry);
            displayEntries(favoriteData, 'favorite-entries');
        }

        // Search entries
        function searchEntries() {
            const query = document.getElementById("search").value.toLowerCase().trim();
            
            if (!query) {
                showToast(t('enter-search'), "error");
                showEmptySearchState();
                return;
            }
            
            hideEmptySearchState();
            
            let filtered = Object.entries(allEntries).filter(([_, entry]) => {
                const searchableText = Object.values(entry).join(" ").toLowerCase();
                return searchableText.includes(query);
            });
            
            // Apply category filter if not 'all'
            if (currentFilter !== 'all') {
                filtered = filtered.filter(([_, entry]) => 
                    entry.category && entry.category.toLowerCase().includes(currentFilter.toLowerCase())
                );
            }
            
            displayEntries(filtered, 'search-results');
            
            if (filtered.length === 0) {
                showToast(t('no-results'), "error");
            } else {
                showToast(t('found-results', { count: filtered.length }), "success");
            }
            
            document.getElementById('search-suggestions').classList.add('hidden');
        }

        // Display entries
        function displayEntries(entries, containerId) {
            const container = document.getElementById(containerId);
            
            if (entries.length === 0) {
                container.innerHTML = `<div class="empty-state">
                    <div class="empty-state-icon">üì≠</div>
                    <div class="empty-state-text">${t('no-results')}</div>
                    <div class="empty-state-subtext">Try searching with different keywords</div>
                </div>`;
                return;
            }
            
            container.innerHTML = entries.map(([key, entry]) => createCompanyCard(key, entry)).join('');
        }

        // Create company card HTML
        function createCompanyCard(key, entry) {
            const isFavorite = favorites.has(key);
            const products = [];
            for (let i = 1; i <= 10; i++) {
                if (entry[`product${i}`]) products.push(entry[`product${i}`]);
            }
            
            return `
                <div class="company-card fade-in">
                    <div class="company-header">
                        <div class="company-info">
                            <h3>${entry.company || 'N/A'}</h3>
                            <div class="company-tags">
                                <span class="tag">${entry.category || 'N/A'}</span>
                                <span class="tag">${entry.brand || 'N/A'}</span>
                            </div>
                        </div>
                        <button class="favorite-btn ${isFavorite ? 'active' : ''}" onclick="toggleFavorite('${key}')">
                            ${isFavorite ? '‚≠ê' : '‚òÜ'}
                        </button>
                    </div>
                    
                    ${products.length > 0 ? `
                        <div class="products-section">
                            <h4 style="color: var(--text-primary); margin-bottom: 0.5rem; font-size: 0.875rem;">${t('products')}:</h4>
                            <div class="products-grid">
                                ${products.slice(0, 5).map(product => `<span class="product-tag">${product}</span>`).join('')}
                                ${products.length > 5 ? `<span class="product-tag">+${products.length - 5} more</span>` : ''}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="contact-section">
                        ${entry.owner ? `
                            <div class="contact-item">
                                <div class="contact-info">
                                    <div class="contact-name">${entry.owner} (Owner)</div>
                                    <div class="contact-phone">${entry.ownerPhone || 'N/A'}</div>
                                </div>
                                <div class="contact-actions">
                                    ${entry.ownerPhone ? `<a href="tel:${entry.ownerPhone}" class="action-btn call-btn" onclick="addToRecent('${key}')" title="${t('call')}">üìû</a>` : ''}
                                    ${entry.ownerEmail ? `<a href="mailto:${entry.ownerEmail}" class="action-btn email-btn" onclick="addToRecent('${key}')" title="${t('email')}">‚úâÔ∏è</a>` : ''}
                                    ${entry.ownerPhone ? `<a href="https://wa.me/91${entry.ownerPhone}?text=Hello%20${encodeURIComponent(entry.owner)},%20this%20is%20from%20VPLY" target="_blank" class="action-btn whatsapp-btn" onclick="addToRecent('${key}')" title="${t('whatsapp')}">üí¨</a>` : ''}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${entry.salesman ? `
                            <div class="contact-item">
                                <div class="contact-info">
                                    <div class="contact-name">${entry.salesman} (Salesman)</div>
                                    <div class="contact-phone">${entry.salesmanPhone || 'N/A'}</div>
                                </div>
                                <div class="contact-actions">
                                    ${entry.salesmanPhone ? `<a href="tel:${entry.salesmanPhone}" class="action-btn call-btn" onclick="addToRecent('${key}')" title="${t('call')}">üìû</a>` : ''}
                                    ${entry.salesmanEmail ? `<a href="mailto:${entry.salesmanEmail}" class="action-btn email-btn" onclick="addToRecent('${key}')" title="${t('email')}">‚úâÔ∏è</a>` : ''}
                                    ${entry.salesmanPhone ? `<a href="https://wa.me/91${entry.salesmanPhone}?text=Hello%20${encodeURIComponent(entry.salesman)},%20this%20is%20from%20VPLY" target="_blank" class="action-btn whatsapp-btn" onclick="addToRecent('${key}')" title="${t('whatsapp')}">üí¨</a>` : ''}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    
                    ${entry.address || entry.latitude ? `
                        <div class="contact-section">
                            <div class="contact-item">
                                <div class="contact-info">
                                    <div class="contact-name">üìç ${entry.address || 'Location Available'}</div>
                                    ${entry.godown ? `<div class="contact-phone">Godown: ${entry.godown}</div>` : ''}
                                </div>
                                <div class="contact-actions">
                                    ${entry.latitude ? `<a href="https://www.google.com/maps?q=${entry.latitude},${entry.longitude}" target="_blank" class="action-btn map-btn" onclick="addToRecent('${key}')" title="${t('maps')}">üó∫Ô∏è</a>` : ''}
                                    ${entry.latitude ? `<button class="action-btn map-btn" onclick="getDirections(${entry.latitude}, ${entry.longitude}); addToRecent('${key}')" title="${t('directions')}">üß≠</button>` : ''}
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${entry.gst || entry.notes ? `
                        <div class="contact-section">
                            ${entry.gst ? `<div style="margin-bottom: 0.5rem;"><strong>GST:</strong> ${entry.gst}</div>` : ''}
                            ${entry.notes ? `<div><strong>Notes:</strong> ${entry.notes}</div>` : ''}
                        </div>
                    ` : ''}
                    
                    ${entry.cardImages || entry.productImages ? `
                        <div class="image-gallery">
                            ${entry.cardImages ? entry.cardImages.split(',').map(img => `<img src="${img}" class="gallery-image" onclick="window.open('${img}', '_blank')" alt="Business Card" />`).join('') : ''}
                            ${entry.productImages ? entry.productImages.split(',').map(img => `<img src="${img}" class="gallery-image" onclick="window.open('${img}', '_blank')" alt="Product" />`).join('') : ''}
                        </div>
                    ` : ''}
                    
                    <div class="flex gap-1 mt-2">
                        <button class="btn btn-secondary btn-small" onclick="editEntry('${key}')" style="flex: 1;">
                            ‚úèÔ∏è Edit
                        </button>
                        <button class="btn btn-red btn-small" onclick="deleteEntry('${key}')">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                    
                    <div class="text-center mt-1" style="font-size: 0.75rem; color: var(--text-secondary);">
                        Added: ${entry.Timestamp || 'N/A'}
                    </div>
                </div>
            `;
        }

        // Toggle favorite
        function toggleFavorite(key) {
            if (favorites.has(key)) {
                favorites.delete(key);
                showToast(t('favorite-removed'), 'info');
            } else {
                favorites.add(key);
                showToast(t('favorite-added'), 'success');
            }
            saveSettings();
            
            // Refresh current view
            const activeTab = document.querySelector('.tab.active').id.replace('tab-', '');
            if (activeTab === 'favorites') {
                displayFavoriteEntries();
            } else if (activeTab === 'recent') {
                displayRecentEntries();
            } else if (activeTab === 'search' && document.getElementById('search').value.trim()) {
                searchEntries();
            }
        }

        // Add to recent
        function addToRecent(key) {
            recentEntries = recentEntries.filter(id => id !== key);
            recentEntries.unshift(key);
            recentEntries = recentEntries.slice(0, 20); // Keep only last 20
            saveSettings();
        }

        // Get current location
        function getCurrentLocation() {
            const btn = document.getElementById('location-btn');
            btn.textContent = '‚è≥';
            btn.disabled = true;
            
            if (!navigator.geolocation) {
                showToast('Geolocation is not supported', 'error');
                btn.textContent = 'üìç';
                btn.disabled = false;
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    currentLocation = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude
                    };
                    
                    // Try to get address from coordinates
                    fetch(`https://api.opencagedata.com/geocode/v1/json?q=${currentLocation.latitude}+${currentLocation.longitude}&key=YOUR_API_KEY`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.results && data.results.length > 0) {
                                document.getElementById('address').value = data.results[0].formatted;
                            } else {
                                document.getElementById('address').value = `${currentLocation.latitude.toFixed(6)}, ${currentLocation.longitude.toFixed(6)}`;
                            }
                        })
                        .catch(() => {
                            document.getElementById('address').value = `${currentLocation.latitude.toFixed(6)}, ${currentLocation.longitude.toFixed(6)}`;
                        });
                    
                    showToast(t('location-obtained'), 'success');
                    btn.textContent = '‚úÖ';
                    setTimeout(() => {
                        btn.textContent = 'üìç';
                        btn.disabled = false;
                    }, 2000);
                },
                (error) => {
                    showToast('Failed to get location: ' + error.message, 'error');
                    btn.textContent = 'üìç';
                    btn.disabled = false;
                }
            );
        }

        // Get directions
        function getDirections(lat, lng) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const url = `https://www.google.com/maps/dir/${position.coords.latitude},${position.coords.longitude}/${lat},${lng}`;
                        window.open(url, '_blank');
                    },
                    () => {
                        const url = `https://www.google.com/maps?q=${lat},${lng}`;
                        window.open(url, '_blank');
                    }
                );
            } else {
                const url = `https://www.google.com/maps?q=${lat},${lng}`;
                window.open(url, '_blank');
            }
        }

        // Add product field
        function addProductField(value = "") {
            if (productCount >= 10) {
                showToast(t('max-products'), "error");
                return;
            }
            
            const id = `product${productCount}`;
            const div = document.createElement("div");
            div.className = "flex gap-1 mb-1";
            div.innerHTML = `
                <input id="${id}" placeholder="Product ${productCount + 1}" value="${value}" style="flex: 1;" />
                ${productCount > 0 ? `<button class="btn btn-red btn-small" onclick="this.parentNode.remove(); productCount--;" style="width: 50px;">üóëÔ∏è</button>` : ''}
            `;
            document.getElementById("product-fields").appendChild(div);
            productCount++;
        }

        // Handle image upload
        function handleImageUpload(input, type) {
            const files = input.files;
            if (!files || files.length === 0) return;
            
            const previewContainer = document.getElementById('image-previews');
            
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'gallery-image';
                        img.onclick = () => window.open(e.target.result, '_blank');
                        previewContainer.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            showToast(`${files.length} image(s) selected for ${type}`, 'success');
        }

        // Save data
        function saveData() {
            const saveBtn = event.target;
            saveBtn.classList.add('loading');
            saveBtn.innerHTML = '‚è≥ Saving...';
            
            const products = [];
            for (let i = 0; i < 10; i++) {
                let el = document.getElementById(`product${i}`);
                if (el && el.value.trim()) products.push(el.value.trim());
            }
            
            const obj = {
                Timestamp: new Date().toLocaleString(),
                company: document.getElementById("company").value.trim(),
                category: document.getElementById("category").value.trim(),
                brand: document.getElementById("brand").value.trim(),
                product1: products[0] || "",
                product2: products[1] || "",
                product3: products[2] || "",
                product4: products[3] || "",
                product5: products[4] || "",
                product6: products[5] || "",
                product7: products[6] || "",
                product8: products[7] || "",
                product9: products[8] || "",
                product10: products[9] || "",
                address: document.getElementById("address").value.trim(),
                owner: document.getElementById("owner").value.trim(),
                ownerPhone: document.getElementById("ownerPhone").value.trim(),
                ownerEmail: document.getElementById("ownerEmail").value.trim(),
                salesman: document.getElementById("salesman").value.trim(),
                salesmanPhone: document.getElementById("salesmanPhone").value.trim(),
                salesmanEmail: document.getElementById("salesmanEmail").value.trim(),
                godown: document.getElementById("godown").value.trim(),
                gst: document.getElementById("gst").value.trim(),
                notes: document.getElementById("notes").value.trim(),
                latitude: currentLocation ? currentLocation.latitude : null,
                longitude: currentLocation ? currentLocation.longitude : null
            };
            
            // Add to undo stack
            undoStack.push({
                action: 'add',
                data: obj,
                timestamp: Date.now()
            });
            updateUndoButton();
            
            db.ref("entries").push(obj, () => {
                showToast(t('saved'), "success");
                sendToSheet(obj);
                clearInputs();
                saveBtn.classList.remove('loading');
                saveBtn.innerHTML = 'üíæ <span data-translate="save-entry">Save Entry</span> <div class="pulse" style="width: 8px; height: 8px; background: white; border-radius: 50%;"></div>';
                updateLanguage(); // Refresh translations
            });
        }

        // Clear inputs
        function clearInputs() {
            document.querySelectorAll('input, textarea').forEach(input => { 
                if(input.type !== 'file') input.value = ''; 
            });
            document.getElementById("product-fields").innerHTML = '';
            document.getElementById("image-previews").innerHTML = '';
            productCount = 0;
            currentLocation = null;
            addProductField(); // Add initial product field
        }

        // Send to Google Sheets
        function sendToSheet(data) {
            fetch("https://script.google.com/macros/s/AKfycbxDuvf5L628eJj_HVssfCmGi_qZi-OjKBy769G0CGIiGvC2or5AbxewkcWptTsILN5b1w/exec", {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });
        }

        // Edit entry
        function editEntry(key) {
            const entry = allEntries[key];
            if (!entry) return;
            
            // Fill form with entry data
            document.getElementById("company").value = entry.company || '';
            document.getElementById("category").value = entry.category || '';
            document.getElementById("brand").value = entry.brand || '';
            document.getElementById("address").value = entry.address || '';
            document.getElementById("owner").value = entry.owner || '';
            document.getElementById("ownerPhone").value = entry.ownerPhone || '';
            document.getElementById("ownerEmail").value = entry.ownerEmail || '';
            document.getElementById("salesman").value = entry.salesman || '';
            document.getElementById("salesmanPhone").value = entry.salesmanPhone || '';
            document.getElementById("salesmanEmail").value = entry.salesmanEmail || '';
            document.getElementById("godown").value = entry.godown || '';
            document.getElementById("gst").value = entry.gst || '';
            document.getElementById("notes").value = entry.notes || '';
            
            // Set location if available
            if (entry.latitude && entry.longitude) {
                currentLocation = {
                    latitude: entry.latitude,
                    longitude: entry.longitude
                };
            }
            
            // Clear and add product fields
            document.getElementById("product-fields").innerHTML = '';
            productCount = 0;
            
            for (let i = 1; i <= 10; i++) {
                if (entry[`product${i}`]) {
                    addProductField(entry[`product${i}`]);
                }
            }
            
            if (productCount === 0) {
                addProductField();
            }
            
            // Store original data for undo
            window.editingKey = key;
            window.originalData = { ...entry };
            
            // Change save button to update
            const saveBtn = document.querySelector('.btn.w-full');
            saveBtn.innerHTML = '‚úèÔ∏è <span data-translate="update-entry">Update Entry</span>';
            saveBtn.onclick = updateEntry;
            
            // Scroll to form
            document.querySelector('.section-card:last-child').scrollIntoView({ behavior: 'smooth' });
            
            showToast('Entry loaded for editing', 'info');
        }

        // Update entry
        function updateEntry() {
            if (!window.editingKey) return;
            
            const saveBtn = event.target;
            saveBtn.classList.add('loading');
            saveBtn.innerHTML = '‚è≥ Updating...';
            
            const products = [];
            for (let i = 0; i < 10; i++) {
                let el = document.getElementById(`product${i}`);
                if (el && el.value.trim()) products.push(el.value.trim());
            }
            
            const updates = {
                Timestamp: new Date().toLocaleString(),
                company: document.getElementById("company").value.trim(),
                category: document.getElementById("category").value.trim(),
                brand: document.getElementById("brand").value.trim(),
                product1: products[0] || "",
                product2: products[1] || "",
                product3: products[2] || "",
                product4: products[3] || "",
                product5: products[4] || "",
                product6: products[5] || "",
                product7: products[6] || "",
                product8: products[7] || "",
                product9: products[8] || "",
                product10: products[9] || "",
                address: document.getElementById("address").value.trim(),
                owner: document.getElementById("owner").value.trim(),
                ownerPhone: document.getElementById("ownerPhone").value.trim(),
                ownerEmail: document.getElementById("ownerEmail").value.trim(),
                salesman: document.getElementById("salesman").value.trim(),
                salesmanPhone: document.getElementById("salesmanPhone").value.trim(),
                salesmanEmail: document.getElementById("salesmanEmail").value.trim(),
                godown: document.getElementById("godown").value.trim(),
                gst: document.getElementById("gst").value.trim(),
                notes: document.getElementById("notes").value.trim(),
                latitude: currentLocation ? currentLocation.latitude : null,
                longitude: currentLocation ? currentLocation.longitude : null
            };
            
            // Add to undo stack
            undoStack.push({
                action: 'update',
                key: window.editingKey,
                originalData: window.originalData,
                newData: updates,
                timestamp: Date.now()
            });
            updateUndoButton();
            
            db.ref(`entries/${window.editingKey}`).update(updates, () => {
                showToast(t('updated'), "success");
                sendToSheet(updates);
                clearInputs();
                
                // Reset save button
                saveBtn.classList.remove('loading');
                saveBtn.innerHTML = 'üíæ <span data-translate="save-entry">Save Entry</span> <div class="pulse" style="width: 8px; height: 8px; background: white; border-radius: 50%;"></div>';
                saveBtn.onclick = saveData;
                
                // Clear editing state
                window.editingKey = null;
                window.originalData = null;
                
                updateLanguage(); // Refresh translations
            });
        }

        // Delete entry
        function deleteEntry(key) {
            if (!confirm(t('confirm-delete'))) return;
            
            const entry = allEntries[key];
            
            // Add to undo stack
            undoStack.push({
                action: 'delete',
                key: key,
                data: entry,
                timestamp: Date.now()
            });
            updateUndoButton();
            
            db.ref(`entries/${key}`).remove(() => {
                showToast(t('deleted'), "success");
                
                // Remove from favorites and recent if present
                favorites.delete(key);
                recentEntries = recentEntries.filter(id => id !== key);
                saveSettings();
                
                // Refresh current view
                const activeTab = document.querySelector('.tab.active').id.replace('tab-', '');
                if (activeTab === 'favorites') {
                    displayFavoriteEntries();
                } else if (activeTab === 'recent') {
                    displayRecentEntries();
                } else if (activeTab === 'search' && document.getElementById('search').value.trim()) {
                    searchEntries();
                }
            });
        }

        // Undo last action
        function undoLastAction() {
            if (undoStack.length === 0) {
                showToast(t('no-undo'), 'info');
                return;
            }
            
            const lastAction = undoStack.pop();
            updateUndoButton();
            
            switch (lastAction.action) {
                case 'add':
                    // Find and remove the entry (this is tricky since we don't store the key)
                    // For now, just show a message
                    showToast('Cannot undo add operation', 'error');
                    break;
                    
                case 'update':
                    db.ref(`entries/${lastAction.key}`).update(lastAction.originalData, () => {
                        showToast(t('undo-success'), 'success');
                    });
                    break;
                    
                case 'delete':
                    db.ref(`entries/${lastAction.key}`).set(lastAction.data, () => {
                        showToast(t('undo-success'), 'success');
                    });
                    break;
            }
        }

        // Update undo button visibility
        function updateUndoButton() {
            const undoBtn = document.getElementById('undo-btn');
            if (undoStack.length > 0) {
                undoBtn.classList.remove('hidden');
            } else {
                undoBtn.classList.add('hidden');
            }
        }

        // Show toast notification
        function showToast(message, type = "info") {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // Show toast
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Hide and remove toast
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Handle enter key on password input
        document.addEventListener('DOMContentLoaded', () => {
            const passwordInput = document.getElementById('passwordInput');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        checkPassword();
                    }
                });
            }
            
            // Close language dropdown when clicking outside
            document.addEventListener('click', (e) => {
                const languageSelector = document.querySelector('.language-selector');
                const dropdown = document.getElementById('language-dropdown');
                
                if (!languageSelector.contains(e.target)) {
                    dropdown.classList.remove('show');
                }
            });
            
            // Close search suggestions when clicking outside
            document.addEventListener('click', (e) => {
                const searchContainer = document.querySelector('.search-container');
                const suggestions = document.getElementById('search-suggestions');
                
                if (!searchContainer.contains(e.target)) {
                    suggestions.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>
